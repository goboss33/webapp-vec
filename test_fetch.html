<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test Fetch n8n - 2</title>
    <style> body { font-family: sans-serif; } pre { background-color: #f0f0f0; padding: 10px; border: 1px solid #ccc; white-space: pre-wrap; word-wrap: break-word; } </style>
</head>
<body>
    <h1>Test d'appel Fetch vers n8n (Get Data)</h1>
    <p>Ouvrez les outils de développement (F12 -> Console et Network) AVANT de cliquer.</p>
    <button id="testButton">Tester Fetch GET vers n8n</button>
    <h3>Résultat :</h3>
    <pre id="result">En attente...</pre>

    <script>
        // js/app.js ou dans le <script> de test_fetch.html

// --- Début du code pertinent ---

// Assure-toi que ces constantes sont définies correctement en haut de ton script
const N8N_GET_DATA_WEBHOOK_URL = 'https://n8n.scalableweb.ch/webhook/webapp/get-product-data';
const TEST_PRODUCT_ID = '11116'; // Ou un autre ID pour tester

const testButton = document.getElementById('testButton');
const resultElement = document.getElementById('result');

testButton.addEventListener('click', async () => {
    resultElement.textContent = 'Appel en cours...';
    testButton.disabled = true;

    // --- Voici la ligne corrigée pour construire l'URL ---
    const urlToFetch = `${N8N_GET_DATA_WEBHOOK_URL}?productId=${TEST_PRODUCT_ID}`;
    // --- Fin de la ligne corrigée ---

    resultElement.textContent += `\nURL: ${urlToFetch}`; // Affiche l'URL construite
    console.log(`Tentative de fetch vers : ${urlToFetch}`); // Log l'URL construite

    try {
        const response = await fetch(urlToFetch); // Lance l'appel GET
        console.log('Réponse brute reçue:', response);
        let responseBodyText = await response.text(); // Lire le corps
        console.log('Corps brut de la réponse:', responseBodyText);

        resultElement.textContent += `\nStatut reçu: ${response.status} ${response.statusText}`;

        if (!response.ok) {
            throw new Error(`Erreur HTTP: ${response.status} ${response.statusText}\nRéponse: ${responseBodyText}`);
        }

        const data = JSON.parse(responseBodyText); // Tenter de parser en JSON
        console.log('Données JSON reçues:', data);
        resultElement.textContent += '\nSuccès!\nDonnées reçues:\n' + JSON.stringify(data, null, 2);

    } catch (error) {
        console.error('Erreur détaillée dans le bloc catch:', error);
        resultElement.textContent += `\n\nERREUR:\n${error.message || error.toString()}`;
        if (error.name === 'TypeError' && error.message.toLowerCase().includes('failed to fetch')) {
            resultElement.textContent += '\n(Ceci indique souvent un problème réseau, DNS, CORS ou URL inaccessible)';
        }
    } finally {
        testButton.disabled = false;
    }
});

// --- Fin du code pertinent ---
    </script>
</body>
</html>